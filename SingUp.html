<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signup</title>
    <script src="https://kit.fontawesome.com/24c494a6b6.js" crossorigin="anonymous"></script>

    <style>
      body {
        text-align: center;
        justify-content: center;
      }
      #container {
    
  
        display: flex;
        margin: auto;
      }
      input {
        width: 80%;
        padding: 20px;
        font-size: 18px;
        margin: 10px auto;
      }
      
     .logo{
      box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
      margin-left: 20px;
      margin-top: 80px;
     }

     #fields{
      margin-left: 160px;
      margin-top: 160px;
     }

      .errMsg {
        color: red;
        font-size: 14px;
        font-style: italic;
        margin-left: -225px;
        margin-top: -10px;
      }
    </style>
  </head>
  <body>
    <h2 id="showOTP"></h2>
    <div id="container">
      <div>
        <img
          class="logo"
          src="https://www.netmeds.com/images/cms/wysiwyg/cms/1588773798_sign-in-banner-new.png"
          alt=""
        />
      </div>

      <div id="fields">
        <h2>Sign in/ Sign up</h2>
        <p>Sign up or Sign in to access your orders, special offers, health tips and more!</p>
        <input
          type="number"
          minlength="10"
          maxlength="10"
          placeholder="Enter your mobile number"
          id="numVal"
        />
        <div id="error"></div>

        <button id="otpBtn">Get OTP</button>
      </div>
      <div id="alt"
      style="display: none;"
       >
        <form action="./index.html">

          <label >EMAIL ID</label>
          <input type="email" id="inpMail" placeholder="Enter your Email Id" required>
          <label >First Name</label>
          <input type="text" id="inpFN" placeholder="Your First Name" required>
          <label >Last Name</label>
          <input type="text" id="inpLN" placeholder="Your Last Name"required>
          <h3>VERIFYING NUMBER</h3>
          <p id="showNum"></p>
          <input type="number" minlength="4" maxlength="4" id="inpOtp" placeholder="Enter OTP" required  >
          <button type="submit" class="verify">Verify</button>
        </form>
      </div>
      <div id="login"
      style="display: none;"
       >
        <form action="./index.html">

          <h3>VERIFYING NUMBER</h3>
          <p id="showNumber"></p>
          <input type="number" minlength="4" maxlength="4" class="inpOtp" placeholder="Enter OTP" required  >
          <button type="submit" class="verify">Verify</button>
        </form>
      </div>
    </div>
  </body>

  <script>
           
    let data = JSON.parse(localStorage.getItem("creds")) || [];
    // console.log(data)
// if(data==''){
//   console.log("EMpty")
// }   
// else{
//   console.log("NOt")
// }

    let errMsg = document.getElementById("error");
    let otpBtn = document.getElementById("otpBtn");

    otpBtn.onclick = () => {
        // console.log("OK")
      let numValue = document.getElementById("numVal").value;
      // console.log(numValue)
      if(data==''){
      console.log("empty")
      if (   numValue != "" && numValue.length == 10 ) {
          fields();
          // getOTP();
        } else {
          let p = document.createElement("p");
          p.innerText = "Please enter a valid number";
          p.classList.add("errMsg");
          errMsg.append(p);
          // ("please enter no.");
        }
    }
    else{

      data.forEach((el)=>{
        
        if(el.number==numValue){
          // console.log(el.number)
          login();
        }
       else if (   numValue != "" && numValue.length == 10 ) {
          fields();
          // getOTP();
        } else {
          let p = document.createElement("p");
          p.innerText = "Please enter a valid number";
          p.classList.add("errMsg");
          errMsg.append(p);
          // ("please enter no.");
        }
        
      })
    }
    };

    let appendOtp = document.getElementById("showOTP");
    function getOTP() {
      let otp = Math.floor(Math.random() * (9999 - 1000) + 1000);
      appendOtp.innerText="OTP: "+otp;
      console.log("OTP: "+otp);
      localStorage.setItem("otp",otp);
    }
    
    function login(){
// alert("ok")
      let f_div = document.getElementById("fields");
      let alt_div = document.getElementById("login");
      f_div.style.display='none';
      alt_div.style.display='grid';
      
      let numValue = document.getElementById("numVal").value;
      let showNum = document.getElementById("showNumber");
      showNum.innerText='We have sent 4 digit OTP on +91'+ numValue;
      // console.log(numValue,showNum)
      
      setTimeout(() => {
        
        getOTP();
      }, 600);
    }

    function fields() {
      let f_div = document.getElementById("fields");
      let alt_div = document.getElementById("alt");
        f_div.style.display='none';
        alt_div.style.display='grid';
        profile();
        let numValue = document.getElementById("numVal").value;
        let showNum = document.getElementById("showNum");
        showNum.innerText='We have sent 4 digit OTP on '+ numValue;
        // let data = JSON.parse(localStorage.getItem("creds")) || [];
        // console.log(data["number"]);
        setTimeout(() => {
          
          getOTP();
        }, 600);
        
    }
    function profile(){
      let data = JSON.parse(localStorage.getItem("creds")) || [];
      let mailVal = document.getElementById("inpMail").value;
      let fnVal = document.getElementById("inpFN").value;
      let lnVal = document.getElementById("inpLN").value;
      let numValue = document.getElementById("numVal").value;

      let obj={
        "email":mailVal,
        "name":fnVal,
        "LName":lnVal,
        "number":numValue
      }
      
      if(mailVal!='' && fnVal!='' && lnVal !=''){

        data.push(obj);
        localStorage.setItem("creds",JSON.stringify(data));
      }
      // console.log(obj)
    }
    
        let verifyBtn = document.querySelector(".verify");
        verifyBtn.onclick=()=>{
          let inpOtp = document.getElementById("inpOtp").value;
          
          let otp= localStorage.getItem("otp");
          if(inpOtp==otp){

            profile()
            // alert("ok")
            // window.open("./index.html");
          }
        }
     
    // check();
   

  </script>
</html>